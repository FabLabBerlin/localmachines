var HeatCanvas=function(a){return"string"==typeof a?this.canvas=document.getElementById(a):this.canvas=a,null==this.canvas?null:(this.worker=new Worker(HeatCanvas.getPath()+"heatcanvas-worker.js"),this.width=this.canvas.width,this.height=this.canvas.height,this.onRenderingStart=null,this.onRenderingEnd=null,void(this.data={}))};HeatCanvas.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b,this.canvas.style.width=a+"px",this.canvas.style.height=b+"px"},HeatCanvas.prototype.push=function(a,b,c){if(!(a<0||a>this.width||b<0||b>this.height)){var d=a+b*this.width;this.data[d]?this.data[d]=this.data[d]+c:this.data[d]=c}},HeatCanvas.prototype.render=function(a,b,c){a=a||1,b=b||HeatCanvas.LINEAR;var d=this;this.worker.onmessage=function(a){d.value=a.data.value,d.data={},d._render(c),d.onRenderingEnd&&d.onRenderingEnd()};var e={data:d.data,width:d.width,height:d.height,step:a,degree:b,value:d.value};this.worker.postMessage(e),this.onRenderingStart&&this.onRenderingStart()},HeatCanvas.prototype._render=function(a){a=a||HeatCanvas.defaultValue2Color;var b=this.canvas.getContext("2d");b.clearRect(0,0,this.width,this.height),defaultColor=this.bgcolor||[0,0,0,255];for(var c=b.createImageData(this.width,this.height),d=0;d<c.data.length;d+=4)c.data[d]=defaultColor[0],c.data[d+1]=defaultColor[1],c.data[d+2]=defaultColor[2],c.data[d+3]=defaultColor[3];var e=0;for(var f in this.value)e=Math.max(this.value[f],e);for(var g in this.value){var h=Math.floor(g%this.width),i=Math.floor(g/this.width),j=i*this.width*4+4*h,k=HeatCanvas.hsla2rgba.apply(null,a(this.value[g]/e));c.data[j]=k[0],c.data[j+1]=k[1],c.data[j+2]=k[2],c.data[j+3]=k[3]}b.putImageData(c,0,0)},HeatCanvas.prototype.clear=function(){this.data={},this.value={},this.canvas.getContext("2d").clearRect(0,0,this.width,this.height)},HeatCanvas.prototype.exportImage=function(){return this.canvas.toDataURL()},HeatCanvas.defaultValue2Color=function(a){var b=1-a,c=.6*a,d=.8,e=1;return[b,d,c,e]},HeatCanvas.hsla2rgba=function(a,b,c,d){function e(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var f,g,h;if(0==b)f=g=h=c;else{var i=c<.5?c*(1+b):c+b-c*b,j=2*c-i;f=e(j,i,a+1/3),g=e(j,i,a),h=e(j,i,a-1/3)}return[255*f,255*g,255*h,255*d]},HeatCanvas.LINEAR=1,HeatCanvas.QUAD=2,HeatCanvas.CUBIC=3,HeatCanvas.getPath=function(){for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){var c=a[b].src,d=c.indexOf("heatcanvas.js");if(d>0)return c.substring(0,d)}return""};